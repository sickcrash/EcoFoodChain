apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ecofood-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
    nginx.ingress.kubernetes.io/use-regex: "true"
spec:
  ingressClassName: nginx 
  rules:
  - http:
      paths:
      # Regola 1: Tutto ciò che inizia con /metaverso va al servizio metaverso
      # Il gruppo (.*) cattura il resto del path e lo passa al container
      - path: /metaverso(/|$)(.*)
        pathType: ImplementationSpecific
        backend:
          service:
            name: metaverso
            port:
              number: 80
      # Regola 2: Tutto ciò che inizia con /filiera360 va al servizio filiera360
      - path: /filiera360(/|$)(.*)
        pathType: ImplementationSpecific
        backend:
          service:
            name: filiera-frontend
            port:
              number: 80
      # Regola 3: Tutto ciò che inizia con /refood va al servizio refood
      - path: /refood(/|$)(.*)
        pathType: ImplementationSpecific
        backend:
          service:
            name: refood-frontend 
            port:
              number: 80
      # Regola 4: Tutto ciò che inizia con /3dguide va al servizio 3dguide (buildform4)
      - path: /3dguide(/|$)(.*)
        pathType: ImplementationSpecific
        backend:
          service:
            name: buildform4
            port:
              number: 80
      # Tutto il resto va al frontend
      - path: /()(.*)
        pathType: ImplementationSpecific
        backend:
          service:
            name: frontend
            port:
              number: 80